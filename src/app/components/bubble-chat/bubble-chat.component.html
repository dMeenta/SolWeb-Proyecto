<div class="relative w-full h-full">
  <!-- Chat (visible cuando showingChat es true) -->
  <div *ngIf="showingChat" @twoStepExpand
    class="absolute overflow-hidden bg-gradient-to-b from-violet-700 to-violet-900 h-110 w-80 right-5/12 bottom-full mb-2 text-white rounded-2xl p-1 flex flex-col shadow-lg">
    <div
      class="bg-transparent flex justify-between content-center text-white px-1 py-1.5 transition-opacity duration-200 delay-75"
      [class]="showingChat ? 'opacity-100' : 'opacity-0'">
      <span>{{friend.friendUsername}}</span>
      <button (click)="closeChat()"
        class="text-rose-600 hover:text-rose-800 transition-colors duration-300 hover:cursor-pointer">
        <i class="fa-solid fa-circle-xmark"></i>
      </button>
    </div>
    <!-- Contenedor de mensajes: crece y hace scroll si es necesario -->
    <div class="flex-1 overflow-y-hidden">
      <app-messages-container [friend]="friend" class="bg-violet-950 w-full h-full flex flex-col rounded-b-2xl p-1" />
    </div>

    <!-- Formulario para enviar mensaje -->

    <div class="relative group w-full p-2 bg-violet-900">
      <input type="text" placeholder="Write a message..." [value]="messageContent()"
        (input)="messageContent.set($any($event.target).value)" name="message"
        class="w-full py-3 pl-5 pr-14 rounded-full bg-violet-800 text-white shadow-md focus:outline-none focus:ring-2 ring-violet-300 placeholder-purple-300" />
      <button type="button" (click)="submit()" [disabled]="!messageContent().trim()"
        class="absolute right-3 top-1/2 transform -translate-y-1/2 px-2 py-1  text-emerald-200 bg-teal-950 not-disabled:hover:bg-teal-800 not-disabled:hover:text-white not-disabled:hover:cursor-pointer disabled:opacity-70 rounded-full shadow-sm transition-all duration-300">
        <i class=" fa-solid fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <!-- Burbuja del perfil -->
  <div class="w-full h-full rounded-full overflow-hidden cursor-pointer transition-transform duration-300"
    [class]="showingChat ? 'ring-2 ring-violet-400 scale-105' : 'ring-2 ring-transparent'" (click)="toggleChat()">
    <img class="w-full h-full object-cover will-change-transform" src="img/profiles/{{friend.friendProfilePicture}}.jpg"
      [alt]="friend.friendUsername">
  </div>
</div>